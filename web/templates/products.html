<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <script src="../static/js/pagination.js"></script>
  <script src="../static/js/popup.js"></script>
  <link rel="stylesheet" href="../static/css/general.css" />
  <link rel="stylesheet" href="../static/css/menu.css" />
  <link rel="icon" href="../static/images/favicon.png" type="image/x-icon" />

  {% if user == "manager" %}
    <title> Manager Menu | Técnico Shop</title>
  {% else %}
    <title> Client Order | Técnico Shop</title>
  {% endif %}

</head>

<body>
  <div class="nav-bar" style="background-color: #bcc5f9e3;">
    <a href="{{url_for('homepage')}}" class="right-side-nav">
      <img src="../static/images/favicon.png" class="logo">
      <p><strong>Técnico Shop</strong></p>
      {% if user == "manager" %}
        <p style="color: #596296;">Manager</p>
      {% else %}
        <p style="color: #596296;">Client</p>
      {% endif %}  
    </a>
    <div>
      <a href="{{url_for('homepage')}}" class="nav-text">Logout</a>
    </div>
  </div>

  {% if user == "manager" %}
    <div class="menu">
      <a href="{{url_for('customers_list', user='manager')}}" class="menu-link">Customers</a>
      <a href="{{url_for('suppliers_list', user='manager')}}" class="menu-link">Suppliers</a>
      <a href="{{url_for('products_list', user='manager')}}" class="menu-link-selected">Products</a>
    </div>
  {% endif %}

  <div style="padding:2%">
    <div class="header">
      <h1>PRODUCTS IN DATABASE</h1>
      {% if user == "manager" %}
        <a href="{{url_for('product_register_get')}}"class="nav-text"><button class="action-button">+ NEW PRODUCT</button></a>
      {% else %}
        <a href="{{url_for('product_register_get')}}"class="nav-text"><button class="action-button">MAKE ORDER</button></a>
      {% endif %} 
    </div>
    <hr class="menu-line">
    <div>
      {% if cursor %}
      <form id="limitForm">
        <div class="table-container">
          <form method="POST" action="/product/edit">
            <table>
              <thead>
                <tr>
                  {% if user == "manager" %}
                    <th>SKU</th>
                  {% endif %} 
                  <th>Name</th>
                  <th>Description</th>
                  <th>Price</th>
                  {% if user == "manager" %}
                    <th>EAN</th>
                    <th></th>
                  {% endif %} 
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {% for record in cursor %}
                <tr>
                  {% if user == "manager" %}
                    <td>
                      {{ record[0] }}
                    </td>
                  {% endif %}
                  <td>
                    <div id="curr-name">
                      {{ record[1] }}
                    </div>
                  </td>
                  <td>
                    <div id="curr-desc-{{ record[0] }}">
                      {{ record[2] }}
                    </div>
                  </td>
                  <td>
                    <div id="curr-price-{{ record[0] }}">
                      {{ record[3] }}
                    </div>
                  </td>
                  {% if user == "manager" %}
                    <td>{{ record[4] }}</td>
                    <td>
                      <p class="edit-text" id="edit-button-{{ record[0] }}" onclick="showPopUp(event, '{{ record[0] }}')">Edit</p>
                    </td>
                  {% endif %}
                  <td>
                    {% if user == "manager" %}
                      <a href="./product/remove?product={{ record[0] }}" class="remove-text">
                        Remove
                      </a>
                    {% else %}
                      <p class="edit-text">Add</p>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </form>

          <form id="offsetForm" action="/products" method="get">
            <div class="show-wrapper">
              <input type="hidden" id="offset" name="offset" value="{{offset}}">
              {% if offset != 0 %}
              <button type="button" onclick="decrementOffset()"><strong>&#9664;</strong></button>
              {% endif %}
              <button type="button" onclick="incrementOffset()"><strong>&#9654;</strong></button>
            </div>
          </form>

        </div>
      {% else %}
      <p>There are no products.</p>
      {% endif %}
    </div>
  </div>

  <!-- Popup form and background -->
  <div id="popupBackground" class="popup-background">
    <div class="popup-form">
      <h2>Edit Product</h2>
      <form action="{{url_for('product_edit')}}" method="POST">
        <input type="hidden" id="popup-sku" name="popup-sku" value="">
        <label for="popup-description">Description:</label><br>
        <input type="text" id="popup-description" name="popup-description"><br>
        <label for="popup-price">Price:</label><br>
        <input type="text" id="popup-price" name="popup-price"><br><br>
        <button type="submit">Save</button>
      </form>
      <button onclick="hidePopUp()">Cancel</button>
    </div>
  </div>

  <footer class="footer-messages">
    <hr>
    Made by Gonçalo Bárias (103134), Raquel Braunschweig (102624) and Vasco Paisana (102533) @ IST
  </footer>

  <script>
    // JavaScript function to show the popup form and pass the record ID
    function showPopUp(event, productId) {
      event.preventDefault();
      document.getElementById("popup-description").value = document.getElementById("curr-desc-" + productId).innerText;
      document.getElementById("popup-price").value = document.getElementById("curr-price-" + productId).innerText;
      document.getElementById("popup-sku").value = productId;
      document.getElementById("popupBackground").style.display = "flex";
    }

    // JavaScript function to hide the popup form
    function hidePopUp() {
      document.getElementById("popupBackground").style.display = "none";
    }
  </script>
</body>

</html>
